<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teste API - Don Tasko</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 800px;
  margin: 50px auto;
  padding: 20px;
  background: #f5f5f5;
}
.result {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.error {
  color: red;
}
.success {
  color: green;
}
button {
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>
<body>
<h1>Teste de Conexão com Google Sheets</h1>
<button onclick="testConnection()">Testar Conexão</button>
<div id="result" class="result"></div>

<script>
const SHEET_ID = '1xjJzNJvhLnoISLsP0qHNQ9HvqrEUZpxwbIdIjGsn3uA';
const API_KEY = 'AIzaSyBNw0g2aBy2vyKfCCvApwrkbiLyeR7vqbI';
const SHEET_NAME = 'Cardapio';

async function testConnection() {
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = 'Testando conexão...';
  
  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    
    resultDiv.innerHTML = `URL sendo testada:\n${url}\n\nAguarde...`;
    
    const response = await fetch(url);
    const data = await response.json();
    
    if (response.ok) {
      resultDiv.innerHTML = `<div class="success">✓ CONEXÃO BEM SUCEDIDA!</div>\n\n`;
      resultDiv.innerHTML += `Dados recebidos:\n${JSON.stringify(data, null, 2)}`;
      
      if (data.values) {
        resultDiv.innerHTML += `\n\n<div class="success">Encontradas ${data.values.length} linhas na planilha</div>`;
        resultDiv.innerHTML += `\nCabeçalhos: ${data.values[0].join(', ')}`;
      }
    } else {
      resultDiv.innerHTML = `<div class="error">✗ ERRO NA CONEXÃO</div>\n\n`;
      resultDiv.innerHTML += `Status: ${response.status}\n`;
      resultDiv.innerHTML += `Resposta: ${JSON.stringify(data, null, 2)}`;
      
      if (data.error) {
        resultDiv.innerHTML += `\n\n<div class="error">Mensagem de erro: ${data.error.message}</div>`;
        
        if (data.error.message.includes('API key not valid')) {
          resultDiv.innerHTML += `\n\n<strong>SOLUÇÃO:</strong> A API Key não é válida. Verifique se:
1. Copiou a chave completa
2. A API do Google Sheets está ativada no projeto
3. A chave não tem restrições que bloqueiem o acesso`;
        }
        
        if (data.error.message.includes('Unable to parse range')) {
          resultDiv.innerHTML += `\n\n<strong>SOLUÇÃO:</strong> O nome da aba está incorreto. Verifique se a aba se chama exatamente "Cardapio"`;
        }
      }
    }
  } catch (error) {
    resultDiv.innerHTML = `<div class="error">✗ ERRO DE CONEXÃO</div>\n\n`;
    resultDiv.innerHTML += `Erro: ${error.message}\n\n`;
    resultDiv.innerHTML += `Tipo: ${error.name}`;
  }
}
</script>
</body>
</html>